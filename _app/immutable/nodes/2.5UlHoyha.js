import{c as G,a as v,d as je,f as C,s as X,t as Se,h as ze}from"../chunks/tMh-h1UU.js";import{i as pe}from"../chunks/B92wWaER.js";import{p as H,f as R,n as ge,a as J,b as w,c as k,r as b,t as Z,l as M,s as c,m as $,z as Y,k as Te,g as e,q as Q,d as fe,aq as qe,o as Be,$ as Re}from"../chunks/4Z14Qsdb.js";import{s as he,r as _e,p as K,i as O,a as De,c as ue}from"../chunks/epDpuhXI.js";import{s as ye,B as U,e as Ve,b as L,t as me,a as Ee}from"../chunks/BklcvC6Y.js";import{B as Me,V as Oe}from"../chunks/B3oLN5Oe.js";import{X as Le}from"../chunks/BoW7udwR.js";import{I as xe}from"../chunks/Dz9LCCOu.js";import{C as Qe,V as be,v as Ue,s as Pe}from"../chunks/5BwgEbfe.js";import{I as Ke}from"../chunks/t8x5iSCf.js";import{s as Xe,b as Ge,c as ke,p as He,T as we,a as Je}from"../chunks/DVFnCog-.js";import{g as ve}from"../chunks/xIHaPDg4.js";function We(S,s){H(s,!0);let f=_e(s,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"m15 18-6-6 6-6"}]];xe(S,he({name:"chevron-left"},()=>f,{get iconNode(){return l},children:(d,a)=>{var r=G(),_=R(r);ye(_,()=>s.children??ge),v(d,r)},$$slots:{default:!0}})),J()}function Ye(S,s){H(s,!0);let f=_e(s,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"m11 17-5-5 5-5"}],["path",{d:"m18 17-5-5 5-5"}]];xe(S,he({name:"chevrons-left"},()=>f,{get iconNode(){return l},children:(d,a)=>{var r=G(),_=R(r);ye(_,()=>s.children??ge),v(d,r)},$$slots:{default:!0}})),J()}function Ze(S,s){H(s,!0);let f=_e(s,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"m6 17 5-5-5-5"}],["path",{d:"m13 17 5-5-5-5"}]];xe(S,he({name:"chevrons-right"},()=>f,{get iconNode(){return l},children:(d,a)=>{var r=G(),_=R(r);ye(_,()=>s.children??ge),v(d,r)},$$slots:{default:!0}})),J()}var et=C('<span> </span> <button class="hover:bg-muted-foreground/20 ml-1 cursor-pointer rounded-full p-0.5 transition-colors" type="button"><!></button>',1),tt=C('<div class="mb-4 flex items-center gap-2"><span class="text-muted-foreground text-sm">当前筛选:</span> <!></div>');function rt(S,s){let f=K(s,"filterTitle",8,""),l=K(s,"filterName",8,""),d=K(s,"onRemove",8,()=>{});var a=G(),r=R(a);{var _=p=>{var I=tt(),A=w(k(I),2);Me(A,{variant:"secondary",class:"flex items-center gap-2 pr-1",children:(y,N)=>{var u=et(),m=R(u),o=k(m);b(m);var V=w(m,2);V.__click=[function(...n){var h;(h=d())==null||h.apply(this,n)}];var g=k(V);Le(g,{class:"h-3 w-3"}),b(V),Z(()=>X(o,`${f()??""}： ${l()??""}`)),v(y,u)},$$slots:{default:!0}}),b(I),v(p,I)};O(r,p=>{f()&&l()&&p(_)})}v(S,a)}je(["click"]);var at=C('<div class="mt-8 flex items-center justify-center gap-1"><!> <!> <!> <!> <!></div>');function st(S,s){H(s,!1);const f=$(),l=$(),d=$();let a=K(s,"currentPage",8,0),r=K(s,"totalPages",8,0),_=K(s,"onPageChange",8,()=>{});function p(u){u>=0&&u<r()&&u!==a()&&_()(u)}function I(u,m){const o=[];if(m<=7)for(let g=0;g<m;g++)o.push(g);else{let g=Math.max(0,u-3),n=Math.min(m-1,g+7-1);n===m-1&&(g=Math.max(0,n-7+1));for(let h=g;h<=n;h++)o.push(h)}return o}M(()=>(Y(a()),Y(r())),()=>{c(f,I(a(),r()))}),M(()=>Y(a()),()=>{c(l,a()>0)}),M(()=>(Y(a()),Y(r())),()=>{c(d,a()<r()-1)}),Te(),pe();var A=G(),y=R(A);{var N=u=>{var m=at(),o=k(m);const V=Q(()=>!e(l));U(o,{variant:"outline",size:"sm",class:"h-8 w-8 cursor-pointer p-0",get disabled(){return e(V)},onclick:()=>p(0),children:(x,z)=>{Ye(x,{class:"h-4 w-4"})},$$slots:{default:!0}});var g=w(o,2);const n=Q(()=>!e(l));U(g,{variant:"outline",size:"sm",class:"h-8 w-8 cursor-pointer p-0",get disabled(){return e(n)},onclick:()=>p(a()-1),children:(x,z)=>{We(x,{class:"h-4 w-4"})},$$slots:{default:!0}});var h=w(g,2);Ve(h,1,()=>e(f),x=>x,(x,z)=>{const ee=Q(()=>e(z)===a()?"default":"outline");U(x,{get variant(){return e(ee)},size:"sm",class:"h-8 min-w-8 cursor-pointer",onclick:()=>p(e(z)),children:(oe,$e)=>{fe();var te=Se();Z(()=>X(te,e(z)+1)),v(oe,te)},$$slots:{default:!0}})});var j=w(h,2);const re=Q(()=>!e(d));U(j,{variant:"outline",size:"sm",class:"h-8 w-8 cursor-pointer p-0",get disabled(){return e(re)},onclick:()=>p(a()+1),children:(x,z)=>{Qe(x,{class:"h-4 w-4"})},$$slots:{default:!0}});var ae=w(j,2);const se=Q(()=>!e(d));U(ae,{variant:"outline",size:"sm",class:"h-8 w-8 cursor-pointer p-0",get disabled(){return e(se)},onclick:()=>p(r()-1),children:(x,z)=>{Ze(x,{class:"h-4 w-4"})},$$slots:{default:!0}}),b(m),v(u,m)};O(y,u=>{r()>1&&u(N)})}v(S,A),J()}var ot=C('<p class="mt-2 text-sm text-red-600"> </p>'),nt=C('<div class="min-h-screen bg-gray-50 flex items-center justify-center"><div class="max-w-md w-full space-y-8"><div class="text-center"><h1 class="text-3xl font-bold text-gray-900 mb-2">bili-sync 管理页</h1> <p class="text-gray-600">请输入API Token以访问管理功能</p></div> <div class="bg-white p-8 rounded-lg shadow-md"><div class="space-y-4"><div><label for="token" class="block text-sm font-medium text-gray-700 mb-2">API Token</label> <!> <!></div> <!></div> <div class="mt-6 text-sm text-gray-500"><p>提示：API Token 在配置文件的 auth_token 字段中设置</p></div></div></div></div>');function it(S,s){H(s,!1);const f=qe();let l=$(""),d=$(""),a=$(!1);async function r(){if(!e(l).trim()){c(d,"请输入API Token");return}c(a,!0),c(d,"");try{L.setAuthToken(e(l)),await L.getVideoSources(),f("login-success",{token:e(l)}),me.success("登录成功")}catch(n){L.setAuthToken(""),n.status===401?c(d,"API Token错误，请检查后重试"):c(d,"验证失败，请检查网络连接或Token是否正确"),console.error("Token验证失败:",n)}finally{c(a,!1)}}function _(n){n.key==="Enter"&&r()}pe();var p=nt(),I=k(p),A=w(k(I),2),y=k(A),N=k(y),u=w(k(N),2);Ke(u,{id:"token",type:"password",placeholder:"请输入API Token",onkeydown:_,class:"w-full",get disabled(){return e(a)},get value(){return e(l)},set value(n){c(l,n)},$$legacy:!0});var m=w(u,2);{var o=n=>{var h=ot(),j=k(h,!0);b(h),Z(()=>X(j,e(d))),v(n,h)};O(m,n=>{e(d)&&n(o)})}b(N);var V=w(N,2);const g=Q(()=>e(a)||!e(l).trim());U(V,{onclick:r,get disabled(){return e(g)},class:"w-full",children:(n,h)=>{fe();var j=Se();Z(()=>X(j,e(a)?"验证中...":"登录")),v(n,j)},$$slots:{default:!0}}),b(y),fe(2),b(A),b(I),b(p),v(S,p),J()}var lt=C('<div class="mb-6 flex items-center justify-between"><div class="text-muted-foreground text-sm"> </div> <div class="text-muted-foreground text-sm"> </div></div>'),ct=C('<div class="flex items-center justify-center py-12"><div class="text-muted-foreground">加载中...</div></div>'),dt=C('<div style="max-width: 400px; width: 100%;"><!></div>'),ut=C('<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; width: 100%; max-width: none; justify-items: start;"></div> <!>',1),vt=C('<div class="flex items-center justify-center py-12"><div class="space-y-2 text-center"><p class="text-muted-foreground">暂无视频数据</p> <p class="text-muted-foreground text-sm">尝试搜索或检查视频来源配置</p></div></div>'),ft=C("<!> <!> <!>",1);function St(S,s){H(s,!1);const[f,l]=De(),d=()=>ue(Ue,"$videoSourceStore",f),a=()=>ue(Je,"$appStateStore",f),r=()=>ue(He,"$page",f),_=$(),p=$(),I=$();let A=$(!1),y=$(null),N=$(!1),u=$(0);const m=20;let o=$(null),V=$(null);function g(t){c(A,!0),n()}async function n(){try{const t=await L.getVideoSources();Pe(t.data),x()}catch(t){console.error("加载数据失败:",t),me.error("加载数据失败")}}function h(t){for(const i of Object.values(be)){const P=t.get(i.type);if(P)return{type:i.type,id:P}}return null}function j(t,i){const P=d();if(!P||!t||!i)return"";const T=P[t],D=T==null?void 0:T.find(ne=>ne.id.toString()===i);return(D==null?void 0:D.name)||""}function re(t){const i=Object.values(be).find(P=>P.type===t);return(i==null?void 0:i.title)||""}async function ae(t,i=0,P){c(N,!0);try{const T={page:i,page_size:m};t&&(T.query=t),P&&(T[P.type]=parseInt(P.id));const D=await L.getVideos(T);c(y,D.data),c(u,i)}catch(T){console.error("加载视频失败:",T),me.error("加载视频失败",{description:T.message})}finally{c(N,!1)}}async function se(t){const i=we(a());i?ve(`/${i}&page=${t}`):ve(`/?page=${t}`)}async function x(){const t=r().url.searchParams.get("query");c(o,h(r().url.searchParams)),Xe(t||""),e(o)?Ge(e(o).type,e(o).id):ke(),ae(t||"",parseInt(r().url.searchParams.get("page")||"0"),e(o))}function z(){ke(),ve(`/${we(a())}`)}Be(async()=>{const t=localStorage.getItem("auth_token");if(t&&t.trim())try{const i=await L.getVideoSources();Pe(i.data),c(A,!0),Ee([{label:"主页",isActive:!0}]),x()}catch(i){L.setAuthToken(""),console.error("Token 验证失败:",i)}}),M(()=>(r(),e(V)),()=>{r().url.search!==e(V)&&(c(V,r().url.search),x())}),M(()=>e(y),()=>{c(_,e(y)?Math.ceil(e(y).total_count/m):0)}),M(()=>e(o),()=>{c(p,e(o)?re(e(o).type):"")}),M(()=>e(o),()=>{c(I,e(o)?j(e(o).type,e(o).id):"")}),Te(),pe();var ee=G();ze(t=>{Re.title="主页 - Bili Sync"});var oe=R(ee);{var $e=t=>{it(t,{$$events:{"login-success":g}})},te=t=>{var i=ft(),P=R(i);rt(P,{get filterTitle(){return e(p)},get filterName(){return e(I)},onRemove:z});var T=w(P,2);{var D=F=>{var E=lt(),W=k(E),ie=k(W);b(W);var q=w(W,2),B=k(q);b(q),b(E),Z(()=>{X(ie,`共 ${e(y).total_count??""} 个视频`),X(B,`共 ${e(_)??""} 页`)}),v(F,E)};O(T,F=>{e(y)&&F(D)})}var ne=w(T,2);{var Ie=F=>{var E=ct();v(F,E)},Ae=(F,E)=>{{var W=q=>{var B=ut(),le=R(B);Ve(le,5,()=>e(y).videos,ce=>ce.id,(ce,Ne)=>{var de=dt(),Fe=k(de);Oe(Fe,{get video(){return e(Ne)}}),b(de),v(ce,de)}),b(le);var Ce=w(le,2);st(Ce,{get currentPage(){return e(u)},get totalPages(){return e(_)},onPageChange:se}),v(q,B)},ie=q=>{var B=vt();v(q,B)};O(F,q=>{var B;(B=e(y))!=null&&B.videos.length?q(W):q(ie,!1)},E)}};O(ne,F=>{e(N)?F(Ie):F(Ae,!1)})}v(t,i)};O(oe,t=>{e(A)?t(te,!1):t($e)})}v(S,ee),J(),l()}export{St as component};
