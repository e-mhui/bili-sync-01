import{c as I,a as s,p as Ke,f as g,t as Pe,s as ee}from"./tMh-h1UU.js";import{i as We}from"./B92wWaER.js";import{p as y,f as v,n as z,a as P,g as d,N as re,c as w,r as p,b,q as xe,l as _e,s as he,m as me,z as te,k as Xe,d as le,t as J}from"./4Z14Qsdb.js";import{p as o,i as ie,r as O,s as q,b as be,d as $e}from"./epDpuhXI.js";import{o as pe,s as F,n as qe,d as ae,p as Fe,q as Ye,f as R,u as Ze,g as et,h as ze,e as tt,i as rt,B as Ce,b as at,t as De}from"./BklcvC6Y.js";import{I as He,e as st}from"./Dz9LCCOu.js";import{n as Se,u as ot,d as nt,e as lt,P as it,F as dt,f as ct,g as ut,E as ft,D as vt,h as gt,S as Ue,i as _t,j as ht,k as mt,l as xt,R as pt,m as bt,o as wt,U as yt}from"./DVFnCog-.js";import{g as Pt}from"./xIHaPDg4.js";function $t(i,e){y(e,!0);let a=o(e,"open",15,!1),l=o(e,"onOpenChange",3,Se);ot({variant:pe.with(()=>"alert-dialog"),open:pe.with(()=>a(),r=>{a(r),l()(r)})});var t=I(),n=v(t);F(n,()=>e.children??z),s(i,t),P()}var kt=g("<button><!></button>");function St(i,e){const a=Ke();y(e,!0);let l=o(e,"id",19,()=>qe(a)),t=o(e,"ref",15,null),n=o(e,"disabled",3,!1),r=O(e,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const h=nt({id:pe.with(()=>l()),ref:pe.with(()=>t(),C=>t(C)),disabled:pe.with(()=>!!n())}),x=re(()=>Fe(r,h.props));var c=I(),H=v(c);{var _=C=>{var D=I(),f=v(D);F(f,()=>e.child,()=>({props:d(x)})),s(C,D)},se=C=>{var D=kt();ae(D,()=>({...d(x)}));var f=w(D);F(f,()=>e.children??z),p(D),s(C,D)};ie(H,C=>{e.child?C(_):C(se,!1)})}s(i,c),P()}var At=g("<!> <!>",1),Ot=g("<!> <div><!></div>",1);function Ct(i,e){const a=Ke();y(e,!0);let l=o(e,"id",19,()=>qe(a)),t=o(e,"ref",15,null),n=o(e,"forceMount",3,!1),r=o(e,"interactOutsideBehavior",3,"ignore"),h=o(e,"onCloseAutoFocus",3,Se),x=o(e,"onEscapeKeydown",3,Se),c=o(e,"onOpenAutoFocus",3,Se),H=o(e,"onInteractOutside",3,Se),_=o(e,"preventScroll",3,!0),se=o(e,"trapFocus",3,!0),C=o(e,"restoreScrollDelay",3,null),D=O(e,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","interactOutsideBehavior","onCloseAutoFocus","onEscapeKeydown","onOpenAutoFocus","onInteractOutside","preventScroll","trapFocus","restoreScrollDelay"]);const f=lt({id:pe.with(()=>l()),ref:pe.with(()=>t(),ke=>t(ke))}),Q=re(()=>Fe(D,f.props)),Te=re(()=>f.root.opts.open.current||n());it(i,{get forceMount(){return n()},get present(){return d(Te)},get ref(){return f.opts.ref},presence:we=>{const oe=re(()=>ut({forceMount:n(),present:f.root.opts.open.current,trapFocus:se(),open:f.root.opts.open.current}));dt(we,{get ref(){return f.opts.ref},loop:!0,get trapFocus(){return d(oe)},get id(){return l()},onCloseAutoFocus:L=>{var V;h()(L),!L.defaultPrevented&&((V=f.root.triggerNode)==null||V.focus())},onOpenAutoFocus:L=>{c()(L),!L.defaultPrevented&&(L.preventDefault(),ct(()=>{var V;(V=f.opts.ref.current)==null||V.focus()}))},focusScope:(L,V)=>{let Ae=()=>V==null?void 0:V().props;ft(L,q(()=>d(Q),{get enabled(){return f.root.opts.open.current},get ref(){return f.opts.ref},onEscapeKeydown:de=>{x()(de),!de.defaultPrevented&&f.root.handleClose()},children:(de,Ve)=>{vt(de,q(()=>d(Q),{get ref(){return f.opts.ref},get enabled(){return f.root.opts.open.current},get interactOutsideBehavior(){return r()},onInteractOutside:ce=>{H()(ce),!ce.defaultPrevented&&f.root.handleClose()},children:(ce,Ne)=>{gt(ce,q(()=>d(Q),{get ref(){return f.opts.ref},get enabled(){return f.root.opts.open.current},children:(Be,u)=>{var T=I(),ne=v(T);{var ue=E=>{var W=At(),N=v(W);{var X=B=>{Ue(B,{get preventScroll(){return _()},get restoreScrollDelay(){return C()}})};ie(N,B=>{f.root.opts.open.current&&B(X)})}var S=b(N,2),A=xe(()=>({props:Fe(d(Q),Ae()),...f.snippetProps}));F(S,()=>e.child,()=>d(A)),s(E,W)},j=E=>{var W=Ot(),N=v(W);Ue(N,{get preventScroll(){return _()}});var X=b(N,2);ae(X,A=>({...A}),[()=>Fe(d(Q),Ae())]);var S=w(X);F(S,()=>e.children??z),p(X),s(E,W)};ie(ne,E=>{e.child?E(ue):E(j,!1)})}s(Be,T)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}})},$$slots:{presence:!0}}),P()}function Dt(i,e){y(e,!0);let a=O(e,["$$slots","$$events","$$legacy"]);const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];He(i,q({name:"info"},()=>a,{get iconNode(){return l},children:(t,n)=>{var r=I(),h=v(r);F(h,()=>e.children??z),s(t,r)},$$slots:{default:!0}})),P()}function Ft(i,e){y(e,!0);let a=O(e,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];He(i,q({name:"rotate-ccw"},()=>a,{get iconNode(){return l},children:(t,n)=>{var r=I(),h=v(r);F(h,()=>e.children??z),s(t,r)},$$slots:{default:!0}})),P()}const Tt=Ye({base:"focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive inline-flex w-fit shrink-0 items-center justify-center gap-1 overflow-hidden whitespace-nowrap rounded-md border px-2 py-0.5 text-xs font-medium transition-[color,box-shadow] focus-visible:ring-[3px] [&>svg]:pointer-events-none [&>svg]:size-3",variants:{variant:{default:"bg-primary text-primary-foreground [a&]:hover:bg-primary/90 border-transparent",secondary:"bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90 border-transparent",destructive:"bg-destructive [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/70 border-transparent text-white",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Nt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=o(e,"variant",3,"default"),t=O(e,["$$slots","$$events","$$legacy","ref","href","class","variant","children"]);var n=I(),r=v(n);st(r,()=>e.href?"a":"span",!1,(h,x)=>{be(h,_=>a(_),()=>a()),ae(h,_=>({"data-slot":"badge",href:e.href,class:_,...t}),[()=>R(Tt({variant:l()}),e.class)]);var c=I(),H=v(c);F(H,()=>e.children??z),s(x,c)}),s(i,n),P()}var Bt=g("<div><!></div>");function It(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=Bt();ae(t,r=>({"data-slot":"card",class:r,...l}),[()=>R("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}var Mt=g("<div><!></div>");function zt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=Mt();ae(t,r=>({"data-slot":"card-content",class:r,...l}),[()=>R("px-6",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}var Rt=g("<div><!></div>");function Vt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=Rt();ae(t,r=>({"data-slot":"card-header",class:r,...l}),[()=>R("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}var jt=g("<div><!></div>");function Et(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=jt();ae(t,r=>({"data-slot":"card-title",class:r,...l}),[()=>R("leading-none font-semibold",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}function Ut(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class"]);var t=I(),n=v(t);const r=re(()=>R("text-lg font-semibold",e.class));$e(n,()=>_t,(h,x)=>{x(h,q({"data-slot":"alert-dialog-title",get class(){return d(r)}},()=>l,{get ref(){return a()},set ref(c){a(c)}}))}),s(i,t),P()}function Kt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class"]);var t=I(),n=v(t);const r=re(()=>R(Ze({variant:"outline"}),e.class));$e(n,()=>St,(h,x)=>{x(h,q({"data-slot":"alert-dialog-cancel",get class(){return d(r)}},()=>l,{get ref(){return a()},set ref(c){a(c)}}))}),s(i,t),P()}var qt=g("<div><!></div>");function Ht(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=qt();ae(t,r=>({"data-slot":"alert-dialog-footer",class:r,...l}),[()=>R("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}var Lt=g("<div><!></div>");function Gt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","children"]);var t=Lt();ae(t,r=>({"data-slot":"alert-dialog-header",class:r,...l}),[()=>R("flex flex-col gap-2 text-center sm:text-left",e.class)]);var n=w(t);F(n,()=>e.children??z),p(t),be(t,r=>a(r),()=>a()),s(i,t),P()}function Jt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class"]);var t=I(),n=v(t);const r=re(()=>R("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e.class));$e(n,()=>ht,(h,x)=>{x(h,q({"data-slot":"alert-dialog-overlay",get class(){return d(r)}},()=>l,{get ref(){return a()},set ref(c){a(c)}}))}),s(i,t),P()}var Qt=g("<!> <!>",1);function Wt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class","portalProps"]);var t=I(),n=v(t);$e(n,()=>mt,(r,h)=>{h(r,q(()=>e.portalProps,{children:(x,c)=>{var H=Qt(),_=v(H);Jt(_,{});var se=b(_,2);const C=re(()=>R("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e.class));$e(se,()=>Ct,(D,f)=>{f(D,q({"data-slot":"alert-dialog-content",get class(){return d(C)}},()=>l,{get ref(){return a()},set ref(Q){a(Q)}}))}),s(x,H)},$$slots:{default:!0}}))}),s(i,t),P()}function Xt(i,e){y(e,!0);let a=o(e,"ref",15,null),l=O(e,["$$slots","$$events","$$legacy","ref","class"]);var t=I(),n=v(t);const r=re(()=>R("text-muted-foreground text-sm",e.class));$e(n,()=>xt,(h,x)=>{x(h,q({"data-slot":"alert-dialog-description",get class(){return d(r)}},()=>l,{get ref(){return a()},set ref(c){a(c)}}))}),s(i,t),P()}const Yt=$t;var Zt=g('<div class="text-muted-foreground flex min-w-0 items-center gap-1 text-sm"><!> <span class="min-w-0 cursor-default truncate"> </span></div>'),er=g('<div class="flex min-w-0 items-start justify-between gap-2"><!> <!></div> <!>',1),tr=g("<div></div>"),rr=g("<p> </p>"),ar=g("<!> <!>",1),sr=g('<div class="space-y-2"><div><span class="truncate">下载进度</span> <span class="shrink-0"> </span></div> <div></div></div>'),or=g('<!> <span class="truncate">详情</span>',1),nr=g("<!> ",1),lr=g('<div class="flex min-w-0 gap-1.5"><!> <!></div>'),ir=g('<div class="space-y-3"><!> <!></div>'),dr=g("<!> <!>",1),cr=g('<p class="mb-2"> </p> <p class="text-sm text-muted-foreground">• <strong>重置失败</strong>：仅重置失败的任务<br/> • <strong>强制重置</strong>：重置所有任务，重新下载</p>',1),ur=g("<!> <!>",1),fr=g("<!> <!> <!>",1),vr=g("<!> <!>",1),gr=g("<!> <!>",1);function Pr(i,e){y(e,!1);const a=me(),l=me(),t=me(),n=me(),r=me(),h=me(),x=me();let c=o(e,"video",8),H=o(e,"showActions",8,!0),_=o(e,"mode",8,"default"),se=o(e,"customTitle",8,""),C=o(e,"customSubtitle",8,""),D=o(e,"taskNames",24,()=>[]),f=o(e,"showProgress",8,!0),Q=o(e,"progressHeight",8,"h-2"),Te=o(e,"gap",8,"gap-1"),ke=o(e,"onReset",8,null),we=o(e,"resetDialogOpen",12,!1),oe=o(e,"resetting",12,!1);function Re(u){return u===7?"已完成":u===0?"未开始":`失败${u}次`}function L(u){return u===7?"bg-green-500":u===0?"bg-yellow-500":"bg-red-500"}function V(u){const T=u.filter(j=>j===7).length,ne=u.length,ue=u.filter(j=>j!==7&&j!==0).length;return T===ne?{text:"全部完成",color:"default"}:ue>0?{text:"部分失败",color:"destructive"}:{text:"进行中",color:"secondary"}}function Ae(u){return D().length>0?D()[u]||`任务${u+1}`:["视频封面","视频信息","UP主头像","UP主信息","分P下载"][u]||`任务${u+1}`}async function de(u=!1){oe(!0);try{if(ke())await ke()();else{const T=await at.resetVideo(c().id,u);T.data.resetted?De.success("重置成功",{description:`已重置 ${T.data.pages.length} 个分P${u?" (强制重置)":""}`}):u?De.info("无任务可重置",{description:"该视频暂无任何任务"}):De.info("重置无效",{description:"所有任务均成功，无需重置。如需重新下载，请使用强制重置。"}),setTimeout(()=>{window.location.reload()},1e3)}}catch(T){console.error("重置失败:",T),De.error("重置失败",{description:T.message})}finally{oe(!1),we(!1)}}function Ve(){Pt(`/video/${c().id}`)}_e(()=>te(c()),()=>{he(a,V(c().download_status))}),_e(()=>te(c()),()=>{he(l,c().download_status.filter(u=>u===7).length)}),_e(()=>te(c()),()=>{he(t,c().download_status.length)}),_e(()=>(te(se()),te(c())),()=>{he(n,se()||c().name)}),_e(()=>(te(C()),te(c())),()=>{he(r,C()||c().upper_name)}),_e(()=>te(_()),()=>{he(h,_()==="default")}),_e(()=>te(_()),()=>{he(x,_()==="default"?"group flex h-full min-w-0 flex-col transition-shadow hover:shadow-md":"transition-shadow hover:shadow-md")}),Xe(),We();var ce=gr(),Ne=v(ce);It(Ne,{get class(){return d(x)},children:(u,T)=>{var ne=dr(),ue=v(ne);const j=xe(()=>_()==="default"?"flex-shrink-0 pb-3":"pb-3");Vt(ue,{get class(){return d(j)},children:(N,X)=>{var S=er(),A=v(S),B=w(A);const Y=xe(()=>(_()==="default","text-base"));Et(B,{get class(){return`line-clamp-2 min-w-0 flex-1 cursor-default ${d(Y)??""} leading-tight`},get title(){return d(n)},children:(k,G)=>{le();var M=Pe();J(()=>ee(M,d(n))),s(k,M)},$$slots:{default:!0}});var U=b(B,2);Nt(U,{get variant(){return d(a).color},class:"shrink-0 text-xs",children:(k,G)=>{le();var M=Pe();J(()=>ee(M,d(a).text)),s(k,M)},$$slots:{default:!0}}),p(A);var $=b(A,2);{var m=k=>{var G=Zt(),M=w(G);{var fe=Z=>{yt(Z,{class:"h-3 w-3 shrink-0"})};ie(M,Z=>{d(h)&&Z(fe)})}var K=b(M,2),ve=w(K,!0);p(K),p(G),J(()=>{et(K,"title",d(r)),ee(ve,d(r))}),s(k,G)};ie($,k=>{d(r)&&k(m)})}s(N,S)},$$slots:{default:!0}});var E=b(ue,2);const W=xe(()=>_()==="default"?"flex min-w-0 flex-1 flex-col justify-end pt-0":"pt-0");zt(E,{get class(){return d(W)},children:(N,X)=>{var S=ir(),A=w(S);{var B=$=>{var m=sr(),k=w(m);ze(k,1,"text-muted-foreground flex justify-between text-xs");var G=b(w(k),2),M=w(G);p(G),p(k);var fe=b(k,2);tt(fe,5,()=>c().download_status,rt,(K,ve,Z)=>{pt(K,{children:(ge,Oe)=>{var je=ar(),Ee=v(je);bt(Ee,{class:"flex-1",children:(Ie,Ge)=>{var ye=tr();J(Me=>ze(ye,1,`${Q()??""} w-full cursor-help rounded-sm transition-all ${Me??""}`),[()=>L(d(ve))],xe),s(Ie,ye)},$$slots:{default:!0}});var Le=b(Ee,2);wt(Le,{children:(Ie,Ge)=>{var ye=rr(),Me=w(ye);p(ye),J((Je,Qe)=>ee(Me,`${Je??""}: ${Qe??""}`),[()=>Ae(Z),()=>Re(d(ve))],xe),s(Ie,ye)},$$slots:{default:!0}}),s(ge,je)},$$slots:{default:!0}})}),p(fe),p(m),J(()=>{ee(M,`${d(l)??""}/${d(t)??""}`),ze(fe,1,`flex w-full ${Te()??""}`)}),s($,m)};ie(A,$=>{f()&&$(B)})}var Y=b(A,2);{var U=$=>{var m=lr(),k=w(m);{var G=K=>{Ce(K,{size:"sm",variant:"outline",class:"min-w-0 flex-1 cursor-pointer px-2 text-xs",onclick:Ve,children:(ve,Z)=>{var ge=or(),Oe=v(ge);Dt(Oe,{class:"mr-1 h-3 w-3 shrink-0"}),le(2),s(ve,ge)},$$slots:{default:!0}})};ie(k,K=>{_()==="default"&&K(G)})}var M=b(k,2);const fe=xe(()=>_()==="detail"?"w-full":"shrink-0");Ce(M,{size:"sm",variant:"outline",get class(){return`${d(fe)??""} cursor-pointer px-2`},onclick:()=>we(!0),children:(K,ve)=>{var Z=nr(),ge=v(Z);Ft(ge,{class:"mr-1 h-3 w-3"});var Oe=b(ge);J(()=>ee(Oe,` ${_()==="detail"?"重置":""}`)),s(K,Z)},$$slots:{default:!0}}),p(m),s($,m)};ie(Y,$=>{H()&&(_()==="default"||_()==="detail")&&$(U)})}p(S),s(N,S)},$$slots:{default:!0}}),s(u,ne)},$$slots:{default:!0}});var Be=b(Ne,2);Yt(Be,{get open(){return we()},set open(u){we(u)},children:(u,T)=>{Wt(u,{children:(ne,ue)=>{var j=vr(),E=v(j);Gt(E,{children:(N,X)=>{var S=ur(),A=v(S);Ut(A,{children:(Y,U)=>{le();var $=Pe("确认重置");s(Y,$)},$$slots:{default:!0}});var B=b(A,2);Xt(B,{children:(Y,U)=>{var $=cr(),m=v($),k=w(m);p(m),le(2),J(()=>ee(k,`确定要重置视频 "${d(n)??""}" 的下载状态吗？`)),s(Y,$)},$$slots:{default:!0}}),s(N,S)},$$slots:{default:!0}});var W=b(E,2);Ht(W,{children:(N,X)=>{var S=fr(),A=v(S);Kt(A,{children:(U,$)=>{le();var m=Pe("取消");s(U,m)},$$slots:{default:!0}});var B=b(A,2);Ce(B,{variant:"secondary",onclick:()=>de(!1),get disabled(){return oe()},children:(U,$)=>{le();var m=Pe();J(()=>ee(m,oe()?"重置中...":"重置失败")),s(U,m)},$$slots:{default:!0}});var Y=b(B,2);Ce(Y,{variant:"destructive",onclick:()=>de(!0),get disabled(){return oe()},children:(U,$)=>{le();var m=Pe();J(()=>ee(m,oe()?"重置中...":"强制重置")),s(U,m)},$$slots:{default:!0}}),s(N,S)},$$slots:{default:!0}}),s(ne,j)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),s(i,ce),P()}export{Nt as B,Pr as V};
