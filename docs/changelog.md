# 更新记录

## v2.7.6.96 (2025-08-18)
- **修复全量/增量模式切换导致的数据损坏问题**
- 修复从增量模式切换到全量模式时重新下载已存在视频的问题
- 全量模式现在会自动检查并跳过已存在的视频，避免数据覆盖
- 修复全量模式切换导致的CID错误和页面名称错误
- 优化日志信息，清楚显示跳过的视频数量和新视频数量

## v2.7.6.95 (2025-08-16)
- **修复UP主增量获取功能问题**
- 修复UP主一天上传多个视频时，只下载第一个视频其他视频被跳过的问题
- 现在可以正确下载UP主当天上传的所有新视频
- **优化日志系统**
- 日志文件现在按天生成（格式：logs-all-2025-08-16.csv）
- 避免长时间运行程序产生的巨大日志文件
- 自动日志轮转，跨天时自动创建新文件

## v2.7.6.94 (2025-08-09)
- **优化移动端界面体验**
- 修复视频管理页在手机端排序和筛选功能显示不全的问题
- 改进响应式布局，确保所有控件在小屏幕设备上正常显示
- 优化按钮文字显示，在移动端自动简化以节省空间
- **改进导航逻辑**
- 修正视频详情页的面包屑导航，上级页面从主页改为视频管理页

## v2.7.6.93 (2025-08-09)
- **修复重命名功能问题**
- 修复单P/多P视频重命名时创建重复子目录的问题
- 修复UP主名称中特殊字符显示错误的问题（如等号、引号等现在能正确显示）
- 优化文件路径处理，确保重命名后的目录结构正确

## v2.7.6.92 (2025-08-08)
- **修复数据库中page表数据不一致问题**
- 自动检测并修复cid不匹配的page记录
- 自动检测并修复video_id错误的page记录
- 自动标记内容已变化的视频为已删除状态
- 自动设置对应源启用下载已删除视频 
- 修复完毕后需要手动禁用下载已删除视频

## v2.7.6.91 (2025-08-05)
- **优化NFO生成中的UP主信息显示**
- 修复GitHub Issue #42：NFO使用UP主昵称导致Jellyfin无法匹配头像的问题
- 现在使用UID作为演员name字段，UP主名称作为role字段
- 无效UID时回退使用昵称，确保兼容性
- 新增Jellyfin字幕显示问题的FAQ文档
- 文档优化：添加Jellyfin字幕渲染设置说明

## v2.7.6.9 (2025-08-04)
- **修复合集视频通知显示"未知"的问题**
- 为Collection枚举添加title和arc字段，包含视频标题和作者信息
- 更新通知系统，从arc字段中提取UP主名称
- 完善视频信息存储，确保合集视频也有完整的元数据

## v2.7.6.8 (2025-08-04)
- **修复合集中多P视频下载失败问题**
- 合集统一模式：为多P视频的每个分P添加P01、P02等标识，避免文件名冲突
- 合集分离模式：多P视频使用multi_page_name模板，确保每个分P有唯一文件名
- 完美解决GitHub Issue #35报告的问题

## v2.7.6.7 (2025-08-01)
- **优化收藏夹扫描体验**
- 智能识别B站API过滤普通视频内的的特殊内容（番剧、纪录片等）调用特殊下载 实现下载而不会400错误
- 改进错误提示，明确说明内容被过滤的原因
- 避免重复扫描被过滤的收藏夹

## v2.7.6.6 (2025-07-31)
- **修复视频源删除时的500错误问题**
- 重构所有视频源（合集、收藏夹、稍后再看、UP主投稿、番剧）的删除逻辑
- 将"删除视频记录"改为"清空源ID字段"，避免删除共享视频时的重复删除错误
- 新增孤立视频检测和清理机制，确保只删除真正无归属的视频
- 增强删除操作的安全边界检查，防止误删其他源的记录
- 修复内存数据库video_source表同步支持，使用season_id作为唯一键
- 优化删除文件逻辑，增加危险路径检测和具体文件夹删除
- **修复配置更新在内存模式下不即时写入主数据库的问题**
- ConfigManager的save_config和update_config_item方法现在会立即同步到主数据库

## v2.7.6.5 (2025-07-31)
- **充电视频检测系统上线**
- 基于API返回的upower字段进行精确充电视频检测
- 新增is_upower_exclusive、is_upower_play、is_upower_preview字段支持
- 移除复杂的87007/87008错误码检测逻辑，提升检测准确性
- 简化错误分类系统，移除过时的充电视频错误处理
- 优化内存数据库连接日志级别，减少繁琐输出
- 清理冗余代码，提升系统性能和可维护性

## v2.7.6.4.2 (2025-07-30)
- **修复内存数据库完整同步时误删主数据库记录的严重bug**
- 重写sync_table_changes_full方法，基于业务唯一键而非自增ID进行记录匹配
- 防止因内存数据库与主数据库ID不一致导致的数据丢失
- 各表使用其真实唯一约束进行删除判断：
  - collection表: s_id + m_id + type
  - page表: video_id + pid
  - favorite表: f_id
  - submission表: upper_id
  - config_items表: key_name
  - video表: 6字段组合唯一约束

## v2.7.6.4.1 (2025-07-30)
- **完全修复内存数据库同步时的UNIQUE约束冲突问题**
- 基于数据库真实约束定义重新设计所有表的唯一性检查方法：
  - video表: 实现复杂的6字段组合约束检查（collection_id+favorite_id+watch_later_id+submission_id+source_id+bvid，含NULL值处理）
  - collection表: 使用s_id+m_id+type组合约束检查
  - page表: 使用video_id+pid组合约束检查
  - favorite表: 使用f_id单字段约束检查
  - submission表: 使用upper_id单字段约束检查
  - config_items表: 使用key_name主键约束检查
- 优化内存数据库与主数据库的ID映射处理逻辑
- 增强所有表同步过程的详细调试日志，便于问题追踪

## v2.7.6.4 (2025-07-29)
- 修复扫描间隔配置在内存模式下无法即时生效的问题
- 修复ConfigManager所有方法的内存模式兼容性
- 修复5个adapter模块函数的内存优化支持
- 修复utils/model.rs中create_videos的批量操作兼容性
- 移除config_changes表的999条记录限制
- 优化日志级别，将技术细节日志从info降级到debug
- 减少日志输出冗余，提升用户体验
- 修复仪表盘下次运行时间固定显示2小时的问题

## v2.7.6.3 (2025-07-29)
- 修复内存模式任务队列状态同步问题
- 修复任务重复执行导致的"合集已存在"错误
- 修复14个数据库操作函数的内存模式兼容性
- 新增任务队列处理完成后的自动同步机制
- 优化任务队列、模型更新、Adapter保存等核心功能
- 修复番剧杜比音频质量ID（30255）识别问题

## v2.7.6.2 (2025-07-28)
- 修复番剧源数据持久化问题
- 修复内存数据库长时运行稳定性问题
- 修复"no such table: collection"错误
- 新增内存数据库守护连接机制
- 新增内存数据库自动重建功能
- 新增周期性连接健康检查
- 优化数据库连接池配置
- 优化内存数据库同步日志级别
- 解决内存数据库重复下载问题
- 修复视频源处理顺序
- 修复推送通知时间显示问题
- 修复"no such table: video_source"错误

## v2.7.6.1 (2025-07-27)
- 统一时间格式处理
- 优化日志系统性能
- 简化时区配置
- 修复黑暗模式输入框对比度
- 修复稍后再看视频源添加问题

## v2.7.6 (2025-07-26)
- 重构Server酱推送通知系统
- 新增文件日志系统
- 修复充电视频误判问题
- 优化试看视频处理

## 2025-07-24
- 新增扫描源顺序优化
- 新增风控断点续传
- 新增错误视频筛选功能
- 优化黑暗模式适配

## 2025-07-23
- 修复番剧缓存未生效问题
- 番剧扫描速度提升60倍

## 2025-07-22  
- 新增番剧缓存机制（24小时）

## 2025-07-21
- 修复QR登录重复生成问题
- 优化登录流程

## 2025-07-20
- 优化视频元数据获取
- 修复封面图片路径问题

## 2025-07-19
- 改进错误处理机制
- 优化任务队列性能

## 更早版本
详见 [GitHub Releases](https://github.com/qq1582185982/bili-sync-01/releases)