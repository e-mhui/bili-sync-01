# 更新记录

## v2.7.6 (2025-07-26)
### 新增功能
- **Server酱推送优化**: 完全重构推送通知系统，提升新视频识别准确性
  - 增强NewVideoInfo结构体，添加发布时间和集数信息字段
  - 改进新视频收集逻辑，通过数据库查询准确识别真正新增的视频
  - 优化推送内容格式，番剧按集数排序，其他视频按时间排序
  - 修复番剧推送时集数识别错误问题（如显示第5集为新但实际更新到第12集）

- **日志系统优化**：
  - 新增文件日志系统，所有日志自动保存到文件
  - 日志文件包含启动时间戳，格式：`logs-{级别}-{年月日}-{时分秒}.csv`
  - 日志文件保存在配置目录的 `logs` 子目录下
  - 支持按级别分文件存储（全部、debug、info、warn、error）
  - 自动清理超过30天的旧日志文件
  - 新增API端点 `/api/logs/files` 和 `/api/logs/download/{filename}` 用于日志文件管理
  - 前端保持显示最新1万行日志，完整日志可通过文件下载

### 修复问题
- **充电视频误判修复**: 修复正常视频被误判为充电专享视频的问题
  - 修正了视频流为空时错误使用87008错误码的逻辑
  - 现在只有B站API明确返回87007/87008时才判定为充电专享视频
  - 其他原因（地区限制、版权问题等）导致的视频流为空不再触发自动删除
  - 新增VideoStreamEmpty错误类型，正确区分不同的视频流错误

- **试看视频处理优化**: 
  - 识别并正确处理durl格式的试看视频（通常只有5-6秒）
  - 将试看视频标记为充电视频，避免下载无用的片段
  - 只接受dash格式的完整视频流进行下载

### 技术改进
- 统一时间处理逻辑，全面使用北京时间字符串格式
- 推送通知支持显示视频发布日期和番剧集数信息
- 新视频判定逻辑优化，避免重复推送已存在视频
- 增强API响应日志，详细记录视频流获取失败的原因

## 2025-07-24
### 新增功能
- **扫描源顺序优化**: 新添加的源优先扫描，然后扫描旧源，提升扫描效率
- **风控断点续传**: 触发风控时保存扫描进度，下次扫描从断点继续
- **显示错误视频**: 视频管理页新增筛选错误视频功能，方便排查问题
- **强制重置功能**: 重置对话框区分"重置失败任务"和"强制重置所有"

### 界面优化
- **黑暗模式适配**: API Token登录页面完整支持黑暗模式
- **批量重置优化**: 明确区分重置失败任务和强制重置，避免误操作

### 系统优化
- **风控处理优化**: HTTP 412错误风控检测更加准确，支持源间延迟配置
- **扫描进度保存**: 修复进度保存时机，确保只有完全处理完的源才被记录
- **配置更新优化**: 新增延迟字段到API配置，提升系统稳定性

### 技术改进
- 扫描源ID跟踪功能，支持新旧源分组处理
- 扫描进度实时保存，避免程序异常退出时进度丢失
- 风控时延迟保存策略，确保断点续传的准确性

## 2025-07-23
- 修复番剧缓存未生效问题
- 番剧扫描速度提升 60 倍

## 2025-07-22  
- 添加番剧缓存机制（24小时）
- 新增缓存字段到数据库

## 2025-07-21
- 修复 QR 登录重复生成问题
- 优化登录流程

## 2025-07-20
- 优化视频元数据获取
- 修复封面图片路径问题

## 2025-07-19
- 改进错误处理机制
- 优化任务队列性能

## 更早版本
详见 [GitHub Releases](https://github.com/qq1582185982/bili-sync-01/releases)