# 🛡️ 风险警告功能说明

## 🎯 功能概述

为了保护用户数据安全，避免在下载过程中进行危险操作，我们添加了两个重要的风险警告功能：

1. **删除视频源时的风险警告**
2. **修改文件命名模板时的风险警告**

## ⚠️ 删除视频源风险警告

### 警告内容

当用户尝试删除视频源时，系统会进行**两次确认**：

#### 第一次确认
```
确定要删除视频源 "XXX" 吗？此操作不可撤销。
```

#### 第二次确认（风险警告）
```
⚠️ 重要警告 ⚠️

如果该视频源正在下载中，删除可能导致：
• 下载任务中断
• 文件损坏
• 数据库状态异常

请确保该视频源当前没有正在进行的下载任务！

如果仍要继续删除，出现任何问题需要自行承担后果。

是否确定要继续删除？
```

### 可能的风险

1. **下载任务中断**：正在下载的文件会被强制停止
2. **文件损坏**：部分下载的文件可能无法正常使用
3. **数据库状态异常**：可能导致数据库记录与实际文件不一致

## 📝 修改文件命名模板风险警告

### 触发条件

当修改以下任一配置时会触发警告：
- 视频文件夹命名模板 (`video_name`)
- 分页文件命名模板 (`page_name`)
- 多P视频分页命名模板 (`multi_page_name`)
- 番剧命名模板 (`bangumi_name`)

### 警告内容

系统会进行**两次确认**：

#### 第一次确认（风险警告）
```
⚠️ 重要警告 ⚠️

您正在修改文件命名模板，这将触发文件重命名操作。

如果当前有正在下载的任务，可能导致：
• 下载任务中断
• 文件损坏
• 文件名冲突
• 数据库状态异常

强烈建议：
1. 确保所有下载任务已完成
2. 或暂停所有下载任务

如果仍要继续修改，出现任何问题需要自行承担后果。

是否确定要继续？
```

#### 第二次确认
```
请再次确认：您已了解风险并愿意承担可能的后果？
```

### 可能的风险

1. **下载任务中断**：正在下载的文件可能因为重命名而中断
2. **文件损坏**：重命名过程中可能导致文件损坏
3. **文件名冲突**：新的命名规则可能导致文件名重复
4. **数据库状态异常**：数据库记录的文件路径可能与实际不符

## 💡 最佳实践

### 安全操作建议

1. **删除视频源前**：
   - 检查下载任务列表，确保该视频源没有正在进行的下载
   - 等待所有相关下载完成后再删除

2. **修改命名模板前**：
   - 确保所有下载任务已完成
   - 或者先暂停所有下载任务
   - 修改完成并文件重命名成功后再恢复下载

### 如何检查下载状态

1. 查看视频列表中的状态标签
2. 检查是否有"下载中"或"等待下载"状态的视频
3. 确认所有视频都是"已下载"或"下载失败"状态

## 🔧 技术实现

### 前端实现

```javascript
// 删除视频源的风险警告
if (!confirm(riskWarning)) {
    return; // 用户取消操作
}

// 修改配置的风险警告
const hasNamingChanges = 检查是否修改了命名相关配置;
if (hasNamingChanges) {
    if (!confirm(riskWarning)) {
        return; // 用户取消操作
    }
}
```

### 设计理念

1. **明确告知风险**：详细列出可能的后果
2. **多次确认**：避免误操作
3. **责任明确**：用户需要自行承担风险
4. **建议优先**：提供安全操作的建议

## 📅 更新记录

- **2025-12-11**：添加删除视频源和修改配置时的风险警告功能

## 🤝 用户责任声明

使用这些功能时，请注意：

1. **风险自负**：在收到警告后仍然继续操作，产生的任何问题需要用户自行承担
2. **数据备份**：建议在进行危险操作前备份重要数据
3. **谨慎操作**：请认真阅读警告信息，确保理解风险后再继续

---

通过这些风险警告功能，我们希望帮助用户避免因误操作导致的数据损失，提高系统的安全性和用户体验。 