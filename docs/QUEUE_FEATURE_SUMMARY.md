# 队列管理功能说明

## 功能概述

新增了队列管理页面，用于实时查看和监控系统中各种任务队列的状态。当系统正在扫描时，用户的操作（添加视频源、删除视频源、更新配置等）会自动加入对应的队列，等待扫描完成后按顺序处理。

## 主要特性

### 1. 实时队列状态监控
- **扫描状态**：显示系统是否正在扫描视频源
- **删除队列**：显示等待处理的视频源删除任务
- **添加队列**：显示等待处理的视频源添加任务  
- **配置队列**：显示等待处理的配置更新和重载任务

### 2. 队列详情展示
- 每个队列显示任务数量和处理状态
- 列出队列中的具体任务信息
- 显示任务创建时间和类型
- 实时更新队列状态（每5秒自动刷新）

### 3. 智能任务处理
- 扫描期间的操作自动加入队列
- 扫描完成后按优先级顺序处理：配置 → 删除 → 添加
- 避免并发冲突，确保数据一致性

## 技术实现

### 后端 API
- **路由**：`GET /api/queue-status`
- **功能**：获取所有队列的实时状态信息
- **返回数据**：
  - 扫描状态
  - 各队列长度和处理状态
  - 队列中的任务详情

### 前端页面
- **路径**：`/queue`
- **导航**：侧边栏底部"任务队列"菜单
- **功能**：
  - 状态总览卡片
  - 队列详情展示
  - 手动刷新按钮
  - 自动刷新（5秒间隔）

## 用户界面

### 状态总览
- 4个状态卡片显示关键信息
- 颜色编码的状态标识：
  - 🟢 空闲：队列为空且未在处理
  - 🟡 等待中：有任务等待处理
  - 🔴 处理中：正在处理队列中的任务

### 队列详情
- 删除队列：显示等待删除的视频源任务
- 添加队列：显示等待添加的视频源任务
- 配置队列：分别显示更新配置和重载配置任务

### 说明信息
- 任务处理机制说明
- 队列状态含义解释
- 处理顺序说明

## 使用场景

1. **监控系统状态**：实时了解系统是否在扫描，各队列的繁忙程度
2. **操作确认**：确认自己的操作是否已加入队列等待处理
3. **故障排查**：当操作没有立即生效时，可以查看是否在队列中等待
4. **系统管理**：管理员可以监控系统负载和任务处理情况

## 注意事项

- 队列页面会自动刷新，无需手动刷新
- 扫描期间的所有操作都会被安全地加入队列
- 任务会按照设计的优先级顺序执行，确保系统稳定性
- 队列中的任务信息不包含敏感数据，只显示任务类型和基本信息

## 相关文件

### 后端文件
- `crates/bili_sync/src/api/handler.rs` - 队列状态API实现
- `crates/bili_sync/src/task/http_server.rs` - 路由配置

### 前端文件
- `web/src/routes/queue/+page.svelte` - 队列页面组件
- `web/src/lib/types.ts` - 队列相关类型定义
- `web/src/lib/api.ts` - 队列API调用
- `web/src/lib/components/app-sidebar.svelte` - 侧边栏导航

这个功能完善了系统的用户体验，让用户能够清楚地了解系统状态和任务处理情况，避免了因不了解系统状态而产生的困惑。 