---
title: 视频源管理指南
---

# 视频源管理指南

bili-sync v2.7.3+ 提供了完整的视频源管理解决方案，包括启用/禁用控制、路径重设系统和优化的用户界面。本指南将详细介绍如何使用这些功能来优化您的下载管理。

## 🎛️ 视频源启用/禁用功能

### 功能概述

视频源启用/禁用功能允许您选择性地控制哪些视频源参与扫描和下载，而无需完全删除它们。这对于管理大量视频源、临时暂停特定内容或节省系统资源非常有用。

### 核心特性

- **🎯 精确控制**：独立控制每个视频源的启用状态
- **🔍 智能扫描**：只处理启用状态的视频源，提升效率
- **💾 持久化存储**：状态保存在数据库中，重启后保持
- **🚀 实时响应**：状态变更立即生效，无需重启应用
- **👁️ 视觉反馈**：清晰的视觉指示器显示当前状态

## 🚀 快速开始

### 1. 访问管理界面

打开浏览器，访问 `http://127.0.0.1:12345`，您将看到现代化的管理界面。

### 2. 新式操作界面 (v2.7.3.1+)

在侧边栏中，每个视频源采用了全新的展开式操作菜单设计：

- **悬停显示**：鼠标悬停在视频源上时，右侧会显示"更多操作"图标（三个点）
- **点击展开**：点击图标后展开操作菜单，图标变为向上箭头
- **操作选项**：展开的菜单包含启用/禁用、重设路径、删除等选项

### 3. 切换状态

**启用/禁用操作**：
1. 点击视频源右侧的"更多操作"图标
2. 在展开的菜单中选择"启用"或"禁用"选项
3. 更改会立即生效并自动保存

## 📖 详细使用指南

### 启用视频源

当视频源处于启用状态时：

- ✅ 参与定期扫描任务
- ✅ 检测新增内容并自动下载
- ✅ 显示在活跃视频源列表中
- ✅ 消耗系统资源和网络带宽

### 禁用视频源

当视频源被禁用时：

- ❌ 跳过扫描，不检测新内容
- ❌ 不会下载任何新视频
- ✅ 已下载的内容保持不变
- ✅ 配置和历史记录完全保留
- ✅ 可随时重新启用

### 批量管理

虽然当前版本不支持批量操作，但您可以通过以下策略高效管理多个视频源：

1. **分类管理**：按类型（收藏夹、UP主、番剧等）分别管理
2. **优先级控制**：优先启用高价值内容源
3. **季节性调整**：根据播放季节临时启用番剧源
4. **资源平衡**：在系统资源有限时禁用次要源

## ⚙️ 高级功能

### 扫描逻辑优化

系统在扫描时会自动跳过禁用的视频源，这带来了以下好处：

- **性能提升**：减少不必要的API请求
- **资源节约**：降低CPU和内存使用
- **网络优化**：减少带宽消耗
- **稳定性增强**：减少API限制触发的风险

### 数据库设计

每个视频源表都增加了 `enabled` 字段：

```sql
-- 收藏夹表
ALTER TABLE favorite ADD COLUMN enabled BOOLEAN NOT NULL DEFAULT true;

-- 合集表  
ALTER TABLE collection ADD COLUMN enabled BOOLEAN NOT NULL DEFAULT true;

-- UP主投稿表
ALTER TABLE submission ADD COLUMN enabled BOOLEAN NOT NULL DEFAULT true;

-- 稍后再看表
ALTER TABLE watch_later ADD COLUMN enabled BOOLEAN NOT NULL DEFAULT true;

-- 番剧表
ALTER TABLE video_source ADD COLUMN enabled BOOLEAN NOT NULL DEFAULT true;
```

## 🗂️ 视频源路径重设功能 (v2.7.3+)

### 功能概述

路径重设功能允许您安全地更改视频源的存储路径，并可选择性地移动现有文件到新位置。这个功能特别适合重新组织存储结构或迁移到新的存储设备。

### 核心特性

- **🔒 四步重命名原则**：确保文件移动过程中的数据安全
- **📁 智能文件移动**：基于模板系统重新生成路径
- **🧹 自动清理**：移动完成后清理空的原始目录
- **📊 详细统计**：提供移动文件数量、更新记录等详细反馈
- **🎯 选择性操作**：可选择仅更新路径或同时移动文件

### 使用方法

**通过Web界面操作**：
1. 点击视频源右侧的"更多操作"图标（三个点）
2. 在展开的菜单中选择"重设路径"选项
3. 在弹出的对话框中：
   - 输入新的存储路径
   - 选择是否应用四步重命名移动文件
   - 选择是否清理空的原始文件夹
4. 点击"确认重设"执行操作

**操作选项说明**：
- **应用四步重命名原则移动文件**：勾选后会安全移动现有文件到新路径
- **清理空的原始文件夹**：移动完成后自动删除空的原始目录

### 四步重命名原则

为确保文件移动的安全性，系统采用四步重命名策略：

1. **重命名为临时名称**：避免文件名冲突
2. **移动到目标目录**：使用临时名称进行移动
3. **重命名为最终名称**：在目标位置重命名为正确的文件名
4. **清理临时文件**：删除临时文件和空目录

### API 接口

**路径重设API**：
```bash
# 重设视频源路径
curl -X POST "http://127.0.0.1:12345/api/video-sources/favorite/123/reset-path" \
  -H "Content-Type: application/json" \
  -d '{
    "new_path": "/new/storage/path",
    "apply_rename_rules": true,
    "clean_empty_folders": true
  }'
```

**视频源状态管理API**：
```bash
# 启用视频源
curl -X PUT "http://127.0.0.1:12345/api/video-sources/favorite/123/enable"

# 禁用视频源
curl -X PUT "http://127.0.0.1:12345/api/video-sources/favorite/123/disable"

# 切换状态
curl -X PUT "http://127.0.0.1:12345/api/video-sources/favorite/123/toggle"
```

## 🎯 使用场景

### 启用/禁用功能场景

#### 1. 临时停止下载

**场景**：某个UP主发布了大量不感兴趣的内容
**操作**：临时禁用该UP主的投稿源，避免下载无关内容
**优势**：无需删除配置，稍后可随时重新启用

#### 2. 节省系统资源

**场景**：系统资源紧张，需要减少下载任务
**操作**：禁用优先级较低的视频源
**优势**：释放资源给重要内容，同时保留所有配置

#### 3. 季节性内容管理

**场景**：只在特定时期关注某些番剧
**操作**：根据播放季节启用/禁用番剧源
**优势**：避免下载过季内容，保持库存整洁

#### 4. 网络带宽管理

**场景**：网络带宽有限，需要控制下载量
**操作**：只启用最重要的视频源
**优势**：确保重要内容优先下载，提升用户体验

### 路径重设功能场景

#### 1. 存储迁移

**场景**：需要将视频文件迁移到新的存储设备
**操作**：使用路径重设功能，选择移动文件选项
**优势**：一键完成路径更新和文件迁移，确保数据完整性

#### 2. 存储重组

**场景**：重新组织视频文件的目录结构
**操作**：更改存储路径模板，使用路径重设功能重新整理
**优势**：基于新模板重新生成路径，保持命名一致性

#### 3. 空间清理

**场景**：清理分散在各处的空文件夹
**操作**：使用路径重设功能，启用空文件夹清理选项
**优势**：自动检测并清理移动后的空目录

#### 4. 配置修正

**场景**：早期配置的路径需要调整
**操作**：仅更新数据库路径，不移动文件
**优势**：快速修正配置，无需实际移动文件

## 🔧 故障排除

### 启用/禁用功能问题

**Q: 禁用视频源后，已下载的视频会被删除吗？**
A: 不会。禁用只影响新内容的扫描和下载，已下载的文件完全不受影响。

**Q: 禁用状态会在程序重启后丢失吗？**
A: 不会。状态保存在数据库中，重启后会自动恢复。

**Q: 可以批量启用/禁用多个视频源吗？**
A: 当前版本不支持批量操作，但这是计划中的功能。

**Q: 禁用视频源会删除其配置吗？**
A: 不会。所有配置和历史记录都会保留，只是暂停扫描功能。

### 路径重设功能问题

**Q: 路径重设失败了，文件会丢失吗？**
A: 不会。四步重命名原则确保操作失败时文件仍在原位置，不会有数据丢失。

**Q: 可以撤销路径重设操作吗？**
A: 可以。再次使用路径重设功能，将路径改回原来的位置即可。

**Q: 移动大量文件时程序会卡住吗？**
A: 不会。文件移动操作在后台异步执行，不会阻塞用户界面。

**Q: 如何确认文件移动是否成功？**
A: 操作完成后会显示详细统计信息，包括移动文件数量、更新记录数等。

**Q: 移动文件时遇到权限问题怎么办？**
A: 确保程序对目标目录具有写权限，Windows下可能需要以管理员身份运行。

### 数据库迁移问题

如果在升级过程中遇到数据库相关问题：

1. **备份数据库**：升级前请务必备份
2. **查看日志**：检查启动日志中的迁移信息
3. **手动迁移**：如需要，可手动执行迁移脚本

```bash
# 查看迁移状态
sqlite3 config/bili-sync.db "PRAGMA table_info(favorite);"

# 检查 enabled 字段是否存在
sqlite3 config/bili-sync.db "SELECT enabled FROM favorite LIMIT 1;"
```

## 📊 性能影响分析

### 扫描性能提升

启用状态管理带来显著的性能提升：

| 场景 | 优化前 | 优化后 | 提升幅度 |
|------|--------|--------|----------|
| 扫描100个源，50个禁用 | 100次API请求 | 50次API请求 | 50% ↑ |
| 大型收藏夹扫描 | 2-3秒 | 0-1秒（禁用时） | 100% ↑ |
| 系统资源使用 | 基准 | -30% | 显著降低 |

### 系统稳定性

- **API限制缓解**：减少请求频率，降低被限制风险
- **内存使用优化**：跳过不必要的数据加载
- **并发性能提升**：减少同时进行的扫描任务

## 🔮 未来计划

### 短期功能 (1-2周)

- **批量操作**：支持批量启用/禁用多个视频源
- **快速预设**：保存和应用常用的启用/禁用组合
- **智能建议**：基于使用模式的启用建议

### 中期功能 (1个月)

- **定时控制**：设定特定时间自动启用/禁用
- **条件触发**：基于网络状况或系统负载自动调整
- **统计分析**：提供视频源活跃度分析

### 长期规划 (3个月)

- **智能管理**：AI驱动的视频源管理建议
- **群组管理**：将视频源分组进行批量管理
- **高级策略**：复杂的启用/禁用策略配置

## 💡 最佳实践

### 1. 定期审查

建议每月审查一次视频源状态：
- 识别不再需要的源并禁用
- 重新评估优先级设置
- 清理无效或重复的源

### 2. 资源平衡

在系统资源有限时：
- 优先启用高价值内容源
- 根据观看频率调整启用状态
- 考虑网络带宽限制

### 3. 备份策略

重要配置变更前：
- 备份数据库文件
- 记录当前启用状态
- 准备回滚方案

### 4. 监控反馈

持续监控系统表现：
- 观察扫描时间变化
- 监控资源使用情况
- 记录下载效率改善

---

视频源启用/禁用功能为bili-sync带来了更加灵活和高效的内容管理能力。通过合理使用这一功能，您可以显著提升系统性能，优化资源使用，同时获得更好的用户体验。